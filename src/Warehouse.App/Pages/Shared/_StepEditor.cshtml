@model StepEditorViewModel

<div class="p-6">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
            <i class="fas @Model.StepIcon text-blue-600"></i>
            Configure: @Model.StepName
        </h3>
        <button onclick="document.getElementById('step-modal').classList.add('hidden')"
                class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times text-xl"></i>
        </button>
    </div>

    <p class="text-gray-600 mb-6">@Model.StepDescription</p>

    @if (Model.Errors.Any())
    {
        <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
            <ul class="text-sm text-red-700 list-disc list-inside">
                @foreach (string error in Model.Errors)
                {
                    <li>@error</li>
                }
            </ul>
        </div>
    }

    <form hx-post="?handler=SaveStep&id=@Model.PipelineId&stepId=@Model.StepId"
          hx-target="#step-@Model.StepId"
          hx-swap="outerHTML"
          enctype="application/x-www-form-urlencoded"
          onsubmit="document.getElementById('step-modal').classList.add('hidden')">

        <div class="space-y-4">
            @foreach (IGrouping<string, ParameterFieldViewModel> grouping in Model.Fields.GroupBy(f => f.Group ?? ""))
            {
                @if (!string.IsNullOrEmpty(grouping.Key))
                {
                    <fieldset class="border border-gray-200 rounded-lg p-4">
                        <legend class="text-sm font-medium text-gray-700 px-2">@grouping.Key</legend>
                        @foreach (ParameterFieldViewModel field in grouping.OrderBy(f => f.Order))
                        {
                            <partial name="Shared/_ParameterField" model="field"/>
                        }
                    </fieldset>
                }
                else
                {
                    @foreach (ParameterFieldViewModel field in grouping.OrderBy(f => f.Order))
                    {
                        <partial name="Shared/_ParameterField" model="field"/>
                    }
                }
            }
        </div>

        <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
            <button type="button"
                    onclick="document.getElementById('step-modal').classList.add('hidden')"
                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors">
                Cancel
            </button>
            <button type="submit"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
                <i class="fas fa-save mr-2"></i>Save Changes
            </button>
        </div>
    </form>
</div>
