### MarketCredentials API Tests
### Base URL
@baseUrl = http://localhost:5080
@contentType = application/json

@okxMarketId = 1
@nonExistingMarketId = 999

#######################
### SETUP: Create Market Details First
#######################

### Create OKX Market (run this first if not exists)
POST {{baseUrl}}/market
Content-Type: {{contentType}}

{
  "type": 0
}

###

### Create Binance Market (run this first if not exists)
POST {{baseUrl}}/market
Content-Type: {{contentType}}

{
  "type": 1
}

###

#######################
### GET MARKET CREDENTIALS
#######################

### Get credential for OKX market (may not exist initially)
GET {{baseUrl}}/market/{{okxMarketId}}/credential
Accept: {{contentType}}

###


### Get credential for non-existing market (should fail)
GET {{baseUrl}}/market/{{nonExistingMarketId}}/credential
Accept: {{contentType}}

###

#######################
### CREATE MARKET CREDENTIALS
#######################

### Create OKX credentials (demo)
POST {{baseUrl}}/market/{{okxMarketId}}/credential
Content-Type: {{contentType}}

{
  "apiKey": "demo-okx-api-key-123",
  "passphrase": "demo-passphrase",
  "secretKey": "demo-okx-secret-key-456",
  "isDemo": true
}

###

### Create Binance credentials (live)
POST {{baseUrl}}/market/{{okxMarketId}}/credential
Content-Type: {{contentType}}

{
  "apiKey": "live-binance-api-key-789",
  "passphrase": "live-passphrase",
  "secretKey": "live-binance-secret-key-012",
  "isDemo": false
}

###

### Try to create duplicate credentials for OKX (should fail)
POST {{baseUrl}}/market/{{okxMarketId}}/credential
Content-Type: {{contentType}}

{
  "apiKey": "another-okx-api-key",
  "passphrase": "another-passphrase",
  "secretKey": "another-secret-key",
  "isDemo": true
}

###

### Try to create credentials for non-existing market (should fail)
POST {{baseUrl}}/market/{{nonExistingMarketId}}/credential
Content-Type: {{contentType}}

{
  "apiKey": "invalid-market-api-key",
  "passphrase": "invalid-passphrase",
  "secretKey": "invalid-secret-key",
  "isDemo": true
}

###

### Create credentials with empty values (should fail if validation exists)
POST {{baseUrl}}/market/{{okxMarketId}}/credential
Content-Type: {{contentType}}

{
  "apiKey": "",
  "passphrase": "",
  "secretKey": "",
  "isDemo": true
}

###

#######################
### UPDATE MARKET CREDENTIALS
#######################

### Update OKX credentials
PUT {{baseUrl}}/market/{{okxMarketId}}/credential
Content-Type: {{contentType}}

{
  "apiKey": "updated-okx-api-key-999",
  "passphrase": "updated-passphrase",
  "secretKey": "updated-okx-secret-key-888",
  "isDemo": false
}

###

### Try to update credentials for non-existing market (should fail)
PUT {{baseUrl}}/market/{{nonExistingMarketId}}/credential
Content-Type: {{contentType}}

{
  "apiKey": "non-existing-api-key",
  "passphrase": "non-existing-passphrase",
  "secretKey": "non-existing-secret-key",
  "isDemo": true
}

###

### Try to update credentials that don't exist (should fail)
PUT {{baseUrl}}/market/3/credential
Content-Type: {{contentType}}

{
  "apiKey": "no-creds-api-key",
  "passphrase": "no-creds-passphrase",
  "secretKey": "no-creds-secret-key",
  "isDemo": false
}

###

#######################
### VERIFY UPDATES
#######################

### Get updated OKX credentials
GET {{baseUrl}}/market/{{okxMarketId}}/credential
Accept: {{contentType}}

###

#######################
### DELETE MARKET CREDENTIALS
#######################

### Delete OKX credentials
DELETE {{baseUrl}}/market/{{okxMarketId}}/credential

###

### Try to delete credentials that don't exist (should fail)
DELETE {{baseUrl}}/market/{{okxMarketId}}/credential

###

### Try to delete credentials for non-existing market (should fail)
DELETE {{baseUrl}}/market/{{nonExistingMarketId}}/credential

###

#######################
### VERIFY DELETIONS
#######################

### Verify OKX credentials are deleted
GET {{baseUrl}}/market/{{okxMarketId}}/credential
Accept: {{contentType}}

###

#######################
### INTEGRATION TESTS
#######################

### Full lifecycle test: Create -> Read -> Update -> Delete
POST {{baseUrl}}/market/{{okxMarketId}}/credential
Content-Type: {{contentType}}

{
  "apiKey": "lifecycle-test-api-key",
  "passphrase": "lifecycle-test-passphrase",
  "secretKey": "lifecycle-test-secret-key",
  "isDemo": true
}

###

### Read the created credential
GET {{baseUrl}}/market/{{okxMarketId}}/credential
Accept: {{contentType}}

###

### Update the credential
PUT {{baseUrl}}/market/{{okxMarketId}}/credential
Content-Type: {{contentType}}

{
  "apiKey": "lifecycle-updated-api-key",
  "passphrase": "lifecycle-updated-passphrase",
  "secretKey": "lifecycle-updated-secret-key",
  "isDemo": false
}

###

### Verify the update
GET {{baseUrl}}/market/{{okxMarketId}}/credential
Accept: {{contentType}}

###

### Delete the credential
DELETE {{baseUrl}}/market/{{okxMarketId}}/credential

###

### Verify deletion
GET {{baseUrl}}/market/{{okxMarketId}}/credential
Accept: {{contentType}}

###
